import React, { useState } from 'react';

/**
 * RH26 30FV 팩깡 시뮬레이터 (v2.8 - Fix)
 * - 134+(2500억), 132+(200억), 130-131(90억) 가치 산정
 * - Rich Red & Gold 프리미엄 테마
 * - React Non-boolean attribute 경고 오류 수정 완료
 */

const App = () => {
  // --- 설정 데이터 ---
  const PRICE_PER_PACK = 30; // 30 FV
  
  // 가치 설정 (단위: 억)
  const VAL_134 = 2500;
  const VAL_132 = 200;
  const VAL_130 = 90;
  
  // 확률 계산 (기본 확률 * 4)
  const PROB_134 = 0.18549052 * 4; 
  const PROB_132 = 1.48392415 * 4; 
  const PROB_130 = 100 - (PROB_134 + PROB_132); 
  
  // --- 상태 관리 ---
  const [totalFV, setTotalFV] = useState(0);
  const [totalOpened, setTotalOpened] = useState(0);
  const [numInput, setNumInput] = useState(1);
  const [stats, setStats] = useState({
    ovr134: 0,
    ovr132: 0,
    ovr130: 0,
  });

  // --- 핵심 오픈 로직 ---
  const executeOpen = () => {
    const rand = Math.random() * 100;
    if (rand < PROB_134) return 'ovr134';
    if (rand < (PROB_134 + PROB_132)) return 'ovr132';
    return 'ovr130';
  };

  const openMultiplePacks = () => {
    const count = Math.max(1, Math.min(numInput, 50000)); // 성능을 고려한 최대 5만개 제한
    let results = { ovr134: 0, ovr132: 0, ovr130: 0 };

    for (let i = 0; i < count; i++) {
      results[executeOpen()]++;
    }

    setStats(prev => ({
      ovr134: prev.ovr134 + results.ovr134,
      ovr132: prev.ovr132 + results.ovr132,
      ovr130: prev.ovr130 + results.ovr130,
    }));
    setTotalFV(prev => prev + (PRICE_PER_PACK * count));
    setTotalOpened(prev => prev + count);
  };

  const resetSim = () => {
    setTotalFV(0);
    setTotalOpened(0);
    setStats({ ovr134: 0, ovr132: 0, ovr130: 0 });
    setNumInput(1);
  };

  // --- 가치 계산 및 포맷팅 ---
  const totalValueInBillions = (stats.ovr134 * VAL_134) + (stats.ovr132 * VAL_132) + (stats.ovr130 * VAL_130);
  
  const formatValue = (billions) => {
    if (billions >= 10000) {
      const jo = Math.floor(billions / 10000);
      const eok = billions % 10000;
      return `${jo}조 ${eok > 0 ? eok.toLocaleString() + '억' : ''}`;
    }
    return `${billions.toLocaleString()}억`;
  };

  // CSS 커스텀 스타일 (React 경고 방지를 위해 dangerouslySetInnerHTML 사용)
  const customStyles = `
    .text-shadow-custom {
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .custom-no-scrollbar::-webkit-scrollbar {
      display: none;
    }
  `;

  return (
    <div className="min-h-screen bg-[#1a0000] text-white p-4 font-sans select-none flex flex-col items-center justify-center">
      <style dangerouslySetInnerHTML={{ __html: customStyles }} />
      
      {/* 메인 시뮬레이터 카드 */}
      <div className="w-full max-w-md bg-gradient-to-b from-[#3a0000] to-[#0a0000] rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.9)] border-[3px] border-[#d4af37] overflow-hidden">
        
        {/* 상단 헤더 */}
        <div className="bg-gradient-to-r from-[#d4af37] via-[#f1c40f] to-[#d4af37] p-5 text-center shadow-lg">
          <h1 className="text-2xl font-black text-[#2a0000] tracking-tighter uppercase italic">rh26 30fv팩깡</h1>
        </div>

        {/* 소비 리포트 대시보드 */}
        <div className="grid grid-cols-2 border-b border-[#d4af37]/40 bg-black/40">
          <div className="p-5 text-center border-r border-[#d4af37]/20">
            <p className="text-[#d4af37] text-[11px] uppercase font-black tracking-widest mb-1">소모된 총 FV</p>
            <p className="text-3xl font-black text-white">{totalFV.toLocaleString()}</p>
          </div>
          <div className="p-5 text-center">
            <p className="text-[#d4af37] text-[11px] uppercase font-black tracking-widest mb-1">총 오픈 횟수</p>
            <p className="text-3xl font-black text-white">{totalOpened.toLocaleString()}</p>
          </div>
        </div>

        {/* 등급별 통계 그리드 */}
        <div className="px-6 py-8 grid grid-cols-3 gap-3 bg-white/5">
          <div className="bg-gradient-to-b from-[#d4af37]/20 to-transparent border border-[#d4af37]/50 p-3 rounded-2xl text-center shadow-xl">
            <p className="text-amber-400 text-[10px] font-black mb-1">134 이상</p>
            <p className="text-3xl font-black text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">{stats.ovr134}</p>
            <p className="text-[9px] text-[#d4af37]/70 mt-1 font-bold">확률: {PROB_134.toFixed(2)}%</p>
          </div>
          <div className="bg-white/5 border border-white/20 p-3 rounded-2xl text-center">
            <p className="text-white/60 text-[10px] font-black mb-1">132 이상</p>
            <p className="text-2xl font-black text-white">{stats.ovr132}</p>
            <p className="text-[9px] text-white/30 mt-1 font-bold">{PROB_132.toFixed(2)}%</p>
          </div>
          <div className="bg-black/30 border border-white/5 p-3 rounded-2xl text-center">
            <p className="text-white/30 text-[10px] font-black mb-1">130-131</p>
            <p className="text-xl font-black text-white/40">{stats.ovr130}</p>
            <p className="text-[9px] text-white/10 mt-1 font-bold">{PROB_130.toFixed(2)}%</p>
          </div>
        </div>

        {/* 조작 인터페이스 */}
        <div className="px-8 pb-8 space-y-5">
          <div className="flex flex-col gap-2">
            <label className="text-[10px] font-black text-[#d4af37] ml-1 uppercase tracking-widest opacity-60 text-shadow-custom">Open Quantity</label>
            <div className="flex gap-3 items-center bg-black/50 p-2 rounded-2xl border-2 border-white/10 focus-within:border-[#d4af37] transition-colors">
              <input 
                type="number" 
                value={numInput}
                onChange={(e) => setNumInput(Math.max(1, parseInt(e.target.value) || 0))}
                className="w-full bg-transparent text-center font-black text-2xl text-[#d4af37] outline-none"
              />
              <button 
                onClick={openMultiplePacks}
                className="whitespace-nowrap bg-gradient-to-r from-[#d4af37] to-[#f1c40f] hover:brightness-110 active:scale-95 transition-all px-8 py-4 rounded-xl font-black text-[#2a0000] text-lg shadow-[0_10px_20px_rgba(212,175,55,0.3)]"
              >
                개 까기
              </button>
            </div>
          </div>
          
          <button 
            onClick={resetSim}
            className="w-full bg-white/5 hover:bg-white/10 py-3 rounded-xl font-black text-xs tracking-widest text-white/40 border border-white/5 transition-all uppercase"
          >
            Reset Simulator
          </button>
        </div>

        {/* 최종 획득 가치 표시 섹션 */}
        <div className="bg-black/80 border-t-2 border-[#d4af37]/30 p-8 shadow-inner">
          <div className="text-center space-y-3">
            <p className="text-[#d4af37] text-xs font-black tracking-[0.2em] uppercase opacity-80 text-shadow-custom">Total Estimated Value</p>
            <p className="text-5xl font-black text-white tracking-tighter drop-shadow-[0_0_20px_rgba(212,175,55,0.4)]">
              {formatValue(totalValueInBillions)}
            </p>
            <div className="pt-4">
              <div className="inline-block px-4 py-1.5 bg-red-950/40 rounded-full border border-red-900/50">
                <p className="text-[10px] text-red-500 font-bold italic">
                  ※ 해당 결과는 수수료를 고려하지 않음
                </p>
              </div>
            </div>
          </div>
        </div>

      </div>

      {/* 정보 푸터 */}
      <div className="mt-6 flex flex-col items-center gap-1 opacity-30">
        <p className="text-[10px] font-bold tracking-widest text-[#d4af37]">FIFA MOBILE RH26 EDITION</p>
        <p className="text-[9px] font-medium text-white">PROBABILITY: 0.74% | 5.93% | 93.32%</p>
      </div>
    </div>
  );
};

export default App;